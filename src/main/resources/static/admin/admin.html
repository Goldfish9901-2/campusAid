<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CampusAid-管理员界面</title>
  <link rel="icon" href="/favicon.jpg" />
  <style>  .complaint-table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
  }

  .complaint-table th,
  .complaint-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
  }

  .complaint-table thead th {
    background-color: #f2f2f2;
    position: sticky;
    top: 0;
    z-index: 1;
  }
  </style>
</head>
<body>
<h1 id="admin-title">您是管理员</h1>

<!-- 固定表头 -->
<table id="complaint-table-header" class="complaint-table">
  <thead>
  <tr>
    <th>投诉ID</th>
    <th>板块</th>
    <th>标题</th>
    <th>描述</th>
    <th>用户ID</th>
    <th>处理结果</th>
  </tr>
  </thead>
</table>

<!-- 可滚动内容区域 -->
<div class="complaint-content" style="max-height: 400px; overflow-y: auto;">
  <table id="complaint-table-body" class="complaint-table">
    <tbody id="complaint-table-body-content"></tbody>
  </table>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // 获取用户ID并更新标题
    fetch('/api/user', {
      method: 'GET',
      credentials: 'include'
    })
            .then(response => {
              if (!response.ok) throw new Error('获取用户信息失败');
              return response.json();
            })
            .then(user => {
              const userId = user.id || user.userId || '未知ID';
              document.getElementById('admin-title').textContent = `您是管理员（用户ID: ${userId}）`;

              // 加载投诉列表
              return fetch('/api/complaint', {
                method: 'GET',
                credentials: 'include'
              });
            })
            .then(response => {
              if (!response.ok) {
                return response.text().then(text => {
                  throw new Error(`请求失败: ${text}`);
                });
              }
              return response.json();
            })
            .then(data => {
              console.log("收到的投诉数据：", data);

              const tbody = document.querySelector('#complaint-table tbody');
              tbody.innerHTML = '';

              if (data.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td colspan="6">暂无投诉记录</td>`;
                tbody.appendChild(tr);
                return;
              }

              data.forEach(complaint => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
        <td>${complaint.id}</td>
        <td>${complaint.block || '--'}</td>
        <td>${complaint.title || '无标题'}</td>
        <td>${complaint.description || '无描述'}</td>
        <td>${complaint.senderId}</td>
        <td>${complaint.result || '-'}</td>
    `;
                tbody.appendChild(tr);
              });

            })
            .catch(error => {
              console.error('Error:', error);
              alert('加载数据失败，请确认是否为管理员并重新登录。');
            });
  });

  function formatTime(timeStr) {
    if (!timeStr) return '--';
    return timeStr.replace("T", " ").substring(0, 16);
  }

</script>
</body>
</html>
